<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</title>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
        header { background: #007bff; color: white; padding: 15px; text-align: center; font-size: 22px; }
        section { padding: 20px; }
        .report-box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,.1); }
        input, button, select { padding: 8px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
        button { cursor: pointer; background: #007bff; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #007bff; color: white; }
    </style>
</head>
<body>
<header>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</header>

<section>
    <!-- âœ… ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù (ÙØªØ±Ø© Ø²Ù…Ù†ÙŠØ©) -->
    <div class="report-box">
        <h3>ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù</h3>
        <label>Ø±Ù…Ø² Ø§Ù„Ù…ÙˆØ¸Ù:</label>
        <input type="text" id="empId">
        <label>Ù…Ù†:</label>
        <input type="date" id="fromDate">
        <label>Ø¥Ù„Ù‰:</label>
        <input type="date" id="toDate">
        <button onclick="getSingleReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <div id="singleResult"></div>
    </div>

    <!-- âœ… ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ -->
    <div class="report-box">
        <h3>ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" id="dayReport">
        <button onclick="getDayReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <div id="dayResult"></div>
    </div>

    <!-- âœ… ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© Ù…Ø¬Ù…Ø¹ -->
    <div class="report-box">
        <h3>ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù…Ø¹ Ù„ÙØªØ±Ø© Ø²Ù…Ù†ÙŠØ©</h3>
        <label>Ù…Ù†:</label>
        <input type="date" id="fromPeriod">
        <label>Ø¥Ù„Ù‰:</label>
        <input type="date" id="toPeriod">
        <button onclick="getPeriodReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <div id="periodResult"></div>
    </div>
</section>

<script>
    const GOOGLE_SCRIPT_URL = "Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Web App Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Apps Script";

    /* âœ… 1. ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù */
    function getSingleReport() {
        const emp = document.getElementById("empId").value;
        const from = document.getElementById("fromDate").value;
        const to = document.getElementById("toDate").value;

        if(!emp || !from || !to){
            alert("âš  ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            return;
        }

        fetch(`${GOOGLE_SCRIPT_URL}?action=singleReport&employee_id=${emp}&from=${from}&to=${to}`)
        .then(res => res.json())
        .then(data => {
            if(data.status !== "ok") {
                document.getElementById("singleResult").innerHTML = `<p>âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>`;
                return;
            }

            let html = `<table>
                <tr>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø±Ù…Ø² Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„</th>
                    <th>Ø¢Ø®Ø± Ø®Ø±ÙˆØ¬</th>
                    <th>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
                    <th>Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</th>
                </tr>`;

            data.days.forEach(d => {
                html += `<tr>
                    <td>${d.date}</td>
                    <td>${d.employee_id}</td>
                    <td>${d.first_in || '-'}</td>
                    <td>${d.last_out || '-'}</td>
                    <td>${d.work_hours?.toFixed(2) || '0'}</td>
                    <td>${d.overtime_hours?.toFixed(2) || '0'}</td>
                </tr>`;
            });

            html += `</table>
            <p>âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±: <b>${data.total_days_present}</b></p>
            <p>â± Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: <b>${data.total_work_hours.toFixed(2)}</b></p>
            <p>â• Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©: <b>${data.total_overtime_hours.toFixed(2)}</b></p>`;

            document.getElementById("singleResult").innerHTML = html;
        });
    }

    /* âœ… 2. ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… */
    function getDayReport() {
        const day = document.getElementById("dayReport").value;
        if(!day){ alert("âš  Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ®Ø§Ù‹"); return; }

        fetch(`${GOOGLE_SCRIPT_URL}?action=dayReport&day=${day}`)
        .then(res => res.json())
        .then(data => {
            let html = `<table>
                <tr>
                    <th>Ø±Ù…Ø² Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„</th>
                    <th>Ø¢Ø®Ø± Ø®Ø±ÙˆØ¬</th>
                    <th>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
                    <th>Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</th>
                </tr>`;

            data.forEach(d => {
                html += `<tr>
                    <td>${d.employee_id}</td>
                    <td>${d.first_in || '-'}</td>
                    <td>${d.last_out || '-'}</td>
                    <td>${d.work_hours?.toFixed(2) || '0'}</td>
                    <td>${d.overtime_hours?.toFixed(2) || '0'}</td>
                </tr>`;
            });

            html += `</table>`;
            document.getElementById("dayResult").innerHTML = html;
        });
    }

    /* âœ… 3. ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© Ù…Ø¬Ù…Ø¹ */
    function getPeriodReport() {
        const from = document.getElementById("fromPeriod").value;
        const to = document.getElementById("toPeriod").value;

        fetch(`${GOOGLE_SCRIPT_URL}?action=periodReport&from=${from}&to=${to}`)
        .then(res => res.json())
        .then(data => {
            let html = `<table>
                <tr>
                    <th>Ø±Ù…Ø² Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙˆÙØ± ØªØ§ÙŠÙ…</th>
                </tr>`;

            for(let emp in data){
                html += `<tr>
                    <td>${emp}</td>
                    <td>${data[emp].days_present}</td>
                    <td>${data[emp].total_work_hours.toFixed(2)}</td>
                    <td>${data[emp].total_overtime_hours.toFixed(2)}</td>
                </tr>`;
            }

            html += `</table>`;
            document.getElementById("periodResult").innerHTML = html;
        });
    }
</script>

</body>
</html>
