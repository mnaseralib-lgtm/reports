<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تقارير الحضور</title>
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
        header { background: #007bff; color: white; padding: 15px; text-align: center; font-size: 22px; }
        section { padding: 20px; }
        .report-box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,.1); }
        input, button, select { padding: 8px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
        button { cursor: pointer; background: #007bff; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #007bff; color: white; }
    </style>
</head>
<body>
<header>📊 تقارير نظام الحضور</header>

<section>
    <!-- ✅ تقرير موظف (فترة زمنية) -->
    <div class="report-box">
        <h3>تقرير موظف</h3>
        <label>رمز الموظف:</label>
        <input type="text" id="empId">
        <label>من:</label>
        <input type="date" id="fromDate">
        <label>إلى:</label>
        <input type="date" id="toDate">
        <button onclick="getSingleReport()">عرض التقرير</button>
        <div id="singleResult"></div>
    </div>

    <!-- ✅ تقرير يوم كامل -->
    <div class="report-box">
        <h3>تقرير يوم لجميع الموظفين</h3>
        <label>التاريخ:</label>
        <input type="date" id="dayReport">
        <button onclick="getDayReport()">عرض التقرير</button>
        <div id="dayResult"></div>
    </div>

    <!-- ✅ تقرير فترة مجمع -->
    <div class="report-box">
        <h3>تقرير مجمع لفترة زمنية</h3>
        <label>من:</label>
        <input type="date" id="fromPeriod">
        <label>إلى:</label>
        <input type="date" id="toPeriod">
        <button onclick="getPeriodReport()">عرض التقرير</button>
        <div id="periodResult"></div>
    </div>
</section>

<script>
    const GOOGLE_SCRIPT_URL = "ضع هنا رابط Web App النهائي من Apps Script";

    /* ✅ 1. تقرير موظف */
    function getSingleReport() {
        const emp = document.getElementById("empId").value;
        const from = document.getElementById("fromDate").value;
        const to = document.getElementById("toDate").value;

        if(!emp || !from || !to){
            alert("⚠ يرجى إدخال جميع البيانات");
            return;
        }

        fetch(`${GOOGLE_SCRIPT_URL}?action=singleReport&employee_id=${emp}&from=${from}&to=${to}`)
        .then(res => res.json())
        .then(data => {
            if(data.status !== "ok") {
                document.getElementById("singleResult").innerHTML = `<p>⚠ لا توجد بيانات</p>`;
                return;
            }

            let html = `<table>
                <tr>
                    <th>التاريخ</th>
                    <th>رمز الموظف</th>
                    <th>أول دخول</th>
                    <th>آخر خروج</th>
                    <th>ساعات العمل</th>
                    <th>ساعات إضافية</th>
                </tr>`;

            data.days.forEach(d => {
                html += `<tr>
                    <td>${d.date}</td>
                    <td>${d.employee_id}</td>
                    <td>${d.first_in || '-'}</td>
                    <td>${d.last_out || '-'}</td>
                    <td>${d.work_hours?.toFixed(2) || '0'}</td>
                    <td>${d.overtime_hours?.toFixed(2) || '0'}</td>
                </tr>`;
            });

            html += `</table>
            <p>✅ إجمالي أيام الحضور: <b>${data.total_days_present}</b></p>
            <p>⏱ إجمالي ساعات العمل: <b>${data.total_work_hours.toFixed(2)}</b></p>
            <p>➕ إجمالي الساعات الإضافية: <b>${data.total_overtime_hours.toFixed(2)}</b></p>`;

            document.getElementById("singleResult").innerHTML = html;
        });
    }

    /* ✅ 2. تقرير يوم */
    function getDayReport() {
        const day = document.getElementById("dayReport").value;
        if(!day){ alert("⚠ اختر تاريخاً"); return; }

        fetch(`${GOOGLE_SCRIPT_URL}?action=dayReport&day=${day}`)
        .then(res => res.json())
        .then(data => {
            let html = `<table>
                <tr>
                    <th>رمز الموظف</th>
                    <th>أول دخول</th>
                    <th>آخر خروج</th>
                    <th>ساعات العمل</th>
                    <th>ساعات إضافية</th>
                </tr>`;

            data.forEach(d => {
                html += `<tr>
                    <td>${d.employee_id}</td>
                    <td>${d.first_in || '-'}</td>
                    <td>${d.last_out || '-'}</td>
                    <td>${d.work_hours?.toFixed(2) || '0'}</td>
                    <td>${d.overtime_hours?.toFixed(2) || '0'}</td>
                </tr>`;
            });

            html += `</table>`;
            document.getElementById("dayResult").innerHTML = html;
        });
    }

    /* ✅ 3. تقرير فترة مجمع */
    function getPeriodReport() {
        const from = document.getElementById("fromPeriod").value;
        const to = document.getElementById("toPeriod").value;

        fetch(`${GOOGLE_SCRIPT_URL}?action=periodReport&from=${from}&to=${to}`)
        .then(res => res.json())
        .then(data => {
            let html = `<table>
                <tr>
                    <th>رمز الموظف</th>
                    <th>عدد أيام الحضور</th>
                    <th>إجمالي ساعات العمل</th>
                    <th>إجمالي أوفر تايم</th>
                </tr>`;

            for(let emp in data){
                html += `<tr>
                    <td>${emp}</td>
                    <td>${data[emp].days_present}</td>
                    <td>${data[emp].total_work_hours.toFixed(2)}</td>
                    <td>${data[emp].total_overtime_hours.toFixed(2)}</td>
                </tr>`;
            }

            html += `</table>`;
            document.getElementById("periodResult").innerHTML = html;
        });
    }
</script>

</body>
</html>
