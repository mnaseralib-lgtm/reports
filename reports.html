<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù - Ù…ØªØ±Ùˆ Ø£Ø¨Ùˆ Ù‚ÙŠØ±</title>
    <style>
        :root {
            --primary: #10b981;
            --secondary: #3b82f6;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #06212a;
        }
        
        body {font-family: "Cairo", sans-serif; margin: 0; padding: 20px; direction: rtl; text-align: right; background: #f8fafc;}
        .container {max-width: 1400px; margin: 0 auto;}
        
        .header {background: linear(135deg, var(--dark), #083344); color: white; padding: 25px; border-radius: 16px; margin-bottom: 25px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.1);}
        .header h2 {margin: 0; font-size: 28px; font-weight: 700;}
        .header p {margin: 8px 0 0; opacity: 0.9; font-size: 16px;}
        
        .form-section {background: white; padding: 25px; border-radius: 16px; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #e5e7eb;}
        .form-section h3 {margin-top: 0; color: var(--dark); border-bottom: 2px solid var(--primary); padding-bottom: 12px; font-size: 20px;}
        
        select, input, button {
            padding: 12px 16px; margin: 8px; border: 1px solid #d1d5db; border-radius: 10px;
            font-size: 15px; font-family: "Cairo"; transition: all 0.2s;
        }
        
        select, input {background: white; width: 200px; border: 1px solid #d1d5db;}
        select:focus, input:focus {outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);}
        
        button {background: var(--primary); color: white; border: none; cursor: pointer; font-weight: 600; min-width: 140px;}
        button:hover {transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15);}
        button.secondary {background: var(--secondary);}
        button.warning {background: var(--warning);}
        
        .hidden {display: none;}
        .message {padding: 15px; border-radius: 10px; margin: 15px 0; font-weight: 600; text-align: center;}
        .error {background: #fee2e2; color: var(--danger); border: 1px solid #fecaca;}
        .success {background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0;}
        .loading {background: #dbeafe; color: var(--secondary);}
        
        .employee-info {background: #e0f2fe; padding: 18px; border-radius: 12px; margin: 15px 0; border-right: 4px solid var(--secondary);}
        
        .summary-section {background: linear(135deg, #f0f9ff, #e0f2fe); padding: 25px; border-radius: 16px; margin: 25px 0; border: 1px solid #bae6fd;}
        .summary-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 15px;}
        .summary-item {background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-top: 4px solid var(--primary);}
        .summary-label {font-size: 14px; color: #6b7280; margin-bottom: 8px;}
        .summary-value {font-size: 24px; font-weight: 800; color: var(--dark);}
        .overtime {color: var(--danger);}
        
        table {width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08);}
        th, td {border: 1px solid #e5e7eb; padding: 14px; text-align: center;}
        th {background: var(--dark); color: white; font-weight: 600; font-size: 15px;}
        tr:nth-child(even) {background: #f8fafc;}
        tr:hover {background: #f0f9ff;}
        
        .movements-list {font-size: 12px; color: #6b7280; margin-top: 5px; line-height: 1.6;}
        .report-actions {margin: 25px 0; text-align: center;}
        
        .nav-buttons {display: flex; gap: 15px; justify-content: center; margin-bottom: 25px;}
        .nav-btn {padding: 12px 25px; border-radius: 10px; text-decoration: none; color: white; font-weight: 600; transition: all 0.2s;}
        .nav-btn.primary {background: var(--primary);}
        .nav-btn.secondary {background: var(--secondary);}
        .nav-btn:hover {transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15);}
        
        @media (max-width: 768px) {
            .container {padding: 10px;}
            .summary-grid {grid-template-columns: 1fr;}
            select, input {width: 100%; margin: 5px 0;}
            button {width: 100%; margin: 5px 0;}
            .nav-buttons {flex-direction: column;}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>ğŸ“Š Ù†Ø¸Ø§Ù… ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h2>
            <p>Ù…ØªØ±Ùˆ Ø£Ø¨Ùˆ Ù‚ÙŠØ± - Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</p>
        </div>

        <div class="nav-buttons">
            <a href="index.html" class="nav-btn primary">ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="reports.html" class="nav-btn secondary">ğŸ“Š ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
        </div>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
        <div class="form-section">
            <label for="reportType"><strong>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</strong></label>
            <select id="reportType" onchange="toggleReportForm()">
                <option value="employee">ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù ÙØ±Ø¯ÙŠ</option>
                <option value="day">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ†</option>
                <option value="period">ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© Ù…Ø¬Ù…Ø¹</option>
            </select>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù -->
        <div id="employeeReportForm" class="form-section">
            <h3>ğŸ¯ ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù ÙØ±Ø¯ÙŠ</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: end;">
                <div>
                    <label><strong>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù:</strong></label><br>
                    <input type="text" id="employeeId" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù">
                </div>
                <div>
                    <label><strong>Ù…Ù†:</strong></label><br>
                    <input type="date" id="fromDate">
                </div>
                <div>
                    <label><strong>Ø¥Ù„Ù‰:</strong></label><br>
                    <input type="date" id="toDate">
                </div>
                <div>
                    <button onclick="fetchEmployeeReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                </div>
            </div>
            
            <div id="employeeInfo" class="employee-info hidden"></div>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ† -->
        <div id="dayReportForm" class="form-section hidden">
            <h3>ğŸ“… ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ†</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: end;">
                <div>
                    <label><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong></label><br>
                    <input type="date" id="singleDay">
                </div>
                <div>
                    <button onclick="fetchDayReport()" class="secondary">Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
                </div>
            </div>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© (Ù…Ø¬Ù…Ø¹) -->
        <div id="periodReportForm" class="form-section hidden">
            <h3>ğŸ“Š ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© Ù…Ø¬Ù…Ø¹</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: end;">
                <div>
                    <label><strong>Ù…Ù†:</strong></label><br>
                    <input type="date" id="periodFrom">
                </div>
                <div>
                    <label><strong>Ø¥Ù„Ù‰:</strong></label><br>
                    <input type="date" id="periodTo">
                </div>
                <div>
                    <button onclick="fetchPeriodReport()" class="warning">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¬Ù…Ø¹</button>
                </div>
            </div>
        </div>

        <div id="message" class="message hidden"></div>
        <div id="loading" class="message loading hidden">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù„Ø®Øµ -->
        <div id="summarySection" class="summary-section hidden">
            <h3>ğŸ“ˆ Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
            <div id="summaryContent" class="summary-grid"></div>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
        <div id="reportActions" class="report-actions hidden">
            <button onclick="exportToExcel()" class="secondary">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
            <button onclick="printReport()" class="warning">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div id="resultsSection" class="hidden">
            <h3>ğŸ“‹ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
            <div style="overflow-x: auto;">
                <table id="resultsTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzeBugfSme93srGaJa5h5Kf_pFreNh9PgB39WAYq_VFryNRR2u8eMUkgaIwHNiVy0zA1A/exec";

        function toggleReportForm() {
            const type = document.getElementById("reportType").value;
            document.getElementById("employeeReportForm").classList.toggle("hidden", type !== "employee");
            document.getElementById("dayReportForm").classList.toggle("hidden", type !== "day");
            document.getElementById("periodReportForm").classList.toggle("hidden", type !== "period");
            document.getElementById("message").innerHTML = "";
            document.getElementById("message").classList.add("hidden");
            document.getElementById("resultsSection").classList.add("hidden");
            document.getElementById("reportActions").classList.add("hidden");
            document.getElementById("summarySection").classList.add("hidden");
            document.getElementById("employeeInfo").classList.add("hidden");
        }

        function showLoading(show) {
            document.getElementById("loading").classList.toggle("hidden", !show);
        }

        function showMessage(message, isError = true) {
            const messageEl = document.getElementById("message");
            messageEl.innerHTML = message;
            messageEl.className = isError ? 'message error' : 'message success';
            messageEl.classList.remove("hidden");
        }

        function showEmployeeInfo(employee) {
            const infoEl = document.getElementById("employeeInfo");
            infoEl.innerHTML = `
                <strong>ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù:</strong><br>
                <strong>Ø§Ù„ÙƒÙˆØ¯:</strong> ${employee.employee_id} | 
                <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${employee.name} | 
                <strong>Ø§Ù„Ù…Ù‡Ù†Ø©:</strong> ${employee.occupation}
            `;
            infoEl.classList.remove("hidden");
        }

        // âœ… Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù
        async function fetchEmployeeReport() {
            const emp = document.getElementById("employeeId").value.trim();
            const from = document.getElementById("fromDate").value;
            const to = document.getElementById("toDate").value;

            if (!emp || !from || !to) {
                showMessage("âš  ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");
                return;
            }

            showLoading(true);
            showMessage("");
            document.getElementById("employeeInfo").classList.add("hidden");
            document.getElementById("summarySection").classList.add("hidden");

            try {
                const url = `${SCRIPT_URL}?action=singleReport&employee_id=${emp}&from=${from}&to=${to}`;
                const res = await fetch(url);
                const data = await res.json();

                if (data.error) {
                    showMessage("âš  " + data.error);
                    document.getElementById("resultsSection").classList.add("hidden");
                    document.getElementById("reportActions").classList.add("hidden");
                    return;
                }

                if (!data.days || data.days.length === 0) {
                    showMessage("âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.");
                    document.getElementById("resultsSection").classList.add("hidden");
                    document.getElementById("reportActions").classList.add("hidden");
                    return;
                }

                showMessage(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.days.length} ÙŠÙˆÙ…`, false);
                showEmployeeInfo(data.days[0]);
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ
                showSummary(data.summary, 'employee');
                
                renderEmployeeTable(data.days);
                
                document.getElementById("reportActions").classList.remove("hidden");
            } catch (error) {
                showMessage("âš  Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
            } finally {
                showLoading(false);
            }
        }

        // âœ… Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ
        async function fetchDayReport() {
            const day = document.getElementById("singleDay").value;
            if (!day) {
                showMessage("âš  ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®.");
                return;
            }

            showLoading(true);
            showMessage("");
            document.getElementById("summarySection").classList.add("hidden");

            try {
                const url = `${SCRIPT_URL}?action=dayReport&day=${day}`;
                const res = await fetch(url);
                const data = await res.json();

                if (data.error) {
                    showMessage("âš  " + data.error);
                    return;
                }

                if (!data.employees || data.employees.length === 0) {
                    showMessage("âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….");
                    return;
                }

                showMessage(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.employees.length} Ù…ÙˆØ¸Ù`, false);
                
                // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„ÙŠÙˆÙ…
                showSummary(data.summary, 'day');
                
                renderDayTable(data.employees);
                
                document.getElementById("reportActions").classList.remove("hidden");
            } catch (error) {
                showMessage("âš  Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
            } finally {
                showLoading(false);
            }
        }

        // âœ… Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù…Ø¹
        async function fetchPeriodReport() {
            const from = document.getElementById("periodFrom").value;
            const to = document.getElementById("periodTo").value;
            if (!from || !to) {
                showMessage("âš  ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØªØ±Ø©.");
                return;
            }

            showLoading(true);
            showMessage("");
            document.getElementById("summarySection").classList.add("hidden");

            try {
                const url = `${SCRIPT_URL}?action=periodReport&from=${from}&to=${to}`;
                const res = await fetch(url);
                const data = await res.json();

                if (data.error) {
                    showMessage("âš  " + data.error);
                    return;
                }

                if (!data || Object.keys(data).length === 0) {
                    showMessage("âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‰ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.");
                    return;
                }

                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ø¦Ù† Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ©
                const employeesArray = Object.keys(data).map(empId => {
                    const empData = data[empId];
                    return {
                        employee_id: empId,
                        name: empData.name,
                        occupation: empData.occupation,
                        days_present: empData.days_present || 0,
                        total_work_hours_str: empData.total_work_hours_str || "0:00",
                        total_overtime_hours_str: empData.total_overtime_hours_str || "0:00",
                        average_daily_hours: empData.average_daily_hours || "0:00"
                    };
                });

                showMessage(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${employeesArray.length} Ù…ÙˆØ¸Ù`, false);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª
                const summary = calculatePeriodSummary(employeesArray);
                showSummary(summary, 'period');
                
                renderPeriodTable(employeesArray);
                
                document.getElementById("reportActions").classList.remove("hidden");
            } catch (error) {
                showMessage("âš  Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + error.message);
            } finally {
                showLoading(false);
            }
        }

        // âœ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ
        function showSummary(summary, type) {
            const summarySection = document.getElementById("summarySection");
            const summaryContent = document.getElementById("summaryContent");
            
            let html = '';
            
            if (type === 'employee') {
                html = `
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ§Ù…</div>
                        <div class="summary-value">${summary.total_days} ÙŠÙˆÙ…</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
                        <div class="summary-value">${summary.total_work_hours}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</div>
                        <div class="summary-value overtime">${summary.total_overtime}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ù…ØªÙˆØ³Ø· Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                        <div class="summary-value">${summary.average_work_hours}</div>
                    </div>
                `;
            } else if (type === 'day') {
                html = `
                    <div class="summary-item">
                        <div class="summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                        <div class="summary-value">${summary.total_employees} Ù…ÙˆØ¸Ù</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
                        <div class="summary-value">${summary.total_work_hours}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</div>
                        <div class="summary-value overtime">${summary.total_overtime}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ù…ØªÙˆØ³Ø· Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
                        <div class="summary-value">${summary.average_work_hours}</div>
                    </div>
                `;
            } else if (type === 'period') {
                html = `
                    <div class="summary-item">
                        <div class="summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                        <div class="summary-value">${summary.total_employees} Ù…ÙˆØ¸Ù</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</div>
                        <div class="summary-value">${summary.total_days} ÙŠÙˆÙ…</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
                        <div class="summary-value">${summary.total_work_hours}</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</div>
                        <div class="summary-value overtime">${summary.total_overtime}</div>
                    </div>
                `;
            }
            
            summaryContent.innerHTML = html;
            summarySection.classList.remove("hidden");
        }

        // âœ… Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ù†ÙØ³ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¨Ø³ÙŠØ·Ø©)
        function renderEmployeeTable(days) {
            const thead = document.getElementById("tableHead");
            const tbody = document.getElementById("tableBody");
            const resultsSection = document.getElementById("resultsSection");

            thead.innerHTML = `
                <tr>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„ÙŠÙˆÙ…</th>
                    <th>Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                    <th>Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
                    <th>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
                    <th>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</th>
                    <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</th>
                    <th>Ø§Ù„Ø­Ø±ÙƒØ§Øª</th>
                </tr>
            `;
            
            tbody.innerHTML = days.map(day => `
                <tr>
                    <td>${day.date}</td>
                    <td>${getArabicDayName(day.date)}</td>
                    <td>${day.first_in}</td>
                    <td>${day.last_out}</td>
                    <td><strong>${day.work_hours_str}</strong></td>
                    <td><strong class="overtime">${day.overtime_hours_str}</strong></td>
                    <td>${day.entries_count}</td>
                    <td class="movements-list">
                        ${day.movements ? day.movements.map(m => `${m.type} ${m.time}`).join('<br>') : ''}
                    </td>
                </tr>
            `).join("");

            resultsSection.classList.remove("hidden");
        }

        function renderDayTable(employees) {
            const thead = document.getElementById("tableHead");
            const tbody = document.getElementById("tableBody");
            const resultsSection = document.getElementById("resultsSection");

            thead.innerHTML = `
                <tr>
                    <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ù…Ù‡Ù†Ø©</th>
                    <th>Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                    <th>Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
                    <th>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
                    <th>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</th>
                    <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª</th>
                    <th>Ø§Ù„Ø­Ø±ÙƒØ§Øª</th>
                </tr>
            `;
            
            tbody.innerHTML = employees.map(emp => `
                <tr>
                    <td>${emp.employee_id}</td>
                    <td>${emp.name}</td>
                    <td>${emp.occupation}</td>
                    <td>${emp.first_in}</td>
                    <td>${emp.last_out}</td>
                    <td><strong>${emp.work_hours_str}</strong></td>
                    <td><strong class="overtime">${emp.overtime_hours_str}</strong></td>
                    <td>${emp.entries_count}</td>
                    <td class="movements-list">
                        ${emp.movements ? emp.movements.map(m => `${m.type} ${m.time}`).join('<br>') : ''}
                    </td>
                </tr>
            `).join("");

            resultsSection.classList.remove("hidden");
        }

        function renderPeriodTable(employees) {
            const thead = document.getElementById("tableHead");
            const tbody = document.getElementById("tableBody");
            const resultsSection = document.getElementById("resultsSection");

            thead.innerHTML = `
                <tr>
                    <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù</th>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ù…Ù‡Ù†Ø©</th>
                    <th>Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th>
                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</th>
                    <th>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ</th>
                </tr>
            `;
            
            tbody.innerHTML = employees.map(emp => `
                <tr>
                    <td>${emp.employee_id}</td>
                    <td>${emp.name}</td>
                    <td>${emp.occupation}</td>
                    <td>${emp.days_present}</td>
                    <td><strong>${emp.total_work_hours_str}</strong></td>
                    <td><strong class="overtime">${emp.total_overtime_hours_str}</strong></td>
                    <td>${emp.average_daily_hours}</td>
                </tr>
            `).join("");

            resultsSection.classList.remove("hidden");
        }

        // âœ… Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© (Ù†ÙØ³ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚)
        function calculatePeriodSummary(employees) {
            let totalEmployees = employees.length;
            let totalDays = 0;
            let totalWorkMinutes = 0;
            let totalOvertimeMinutes = 0;
            
            employees.forEach(emp => {
                totalDays += emp.days_present;
                const workTime = emp.total_work_hours_str.split(':');
                totalWorkMinutes += parseInt(workTime[0]) * 60 + parseInt(workTime[1]);
                
                const overtime = emp.total_overtime_hours_str.split(':');
                totalOvertimeMinutes += parseInt(overtime[0]) * 60 + parseInt(overtime[1]);
            });
            
            return {
                total_employees: totalEmployees,
                total_days: totalDays,
                total_work_hours: minutesToTimeStr(totalWorkMinutes),
                total_overtime: minutesToTimeStr(totalOvertimeMinutes)
            };
        }

        function minutesToTimeStr(minutes) {
            if (minutes <= 0) return "0:00";
            const h = Math.floor(minutes / 60);
            const m = minutes % 60;
            return `${h}:${m.toString().padStart(2, "0")}`;
        }

        function getArabicDayName(dateString) {
            const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const date = new Date(dateString);
            return days[date.getDay()];
        }

        function exportToExcel() {
            const table = document.getElementById("resultsTable");
            let csv = [];
            
            const headers = [];
            for (let i = 0; i < table.rows[0].cells.length; i++) {
                headers.push(table.rows[0].cells[i].textContent);
            }
            csv.push(headers.join(","));
            
            for (let i = 1; i < table.rows.length; i++) {
                const row = [];
                for (let j = 0; j < table.rows[i].cells.length; j++) {
                    row.push(table.rows[i].cells[j].textContent);
                }
                csv.push(row.join(","));
            }
            
            const csvContent = "\uFEFF" + csv.join("\n");
            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¶ÙˆØ±_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = "hidden";
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function printReport() {
            const printContent = document.getElementById("resultsSection").innerHTML;
            const summaryContent = document.getElementById("summarySection").innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = `
                <div style="direction: rtl; text-align: right; font-family: Arial, sans-serif; padding: 20px;">
                    <h2 style="text-align: center; color: #06212a;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù - Ù…ØªØ±Ùˆ Ø£Ø¨Ùˆ Ù‚ÙŠØ±</h2>
                    ${summaryContent}
                    ${printContent}
                </div>
            `;
            
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        }

        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            const firstDay = new Date();
            firstDay.setDate(1);
            const firstDayStr = firstDay.toISOString().split('T')[0];
            
            document.getElementById('fromDate').value = firstDayStr;
            document.getElementById('toDate').value = today;
            document.getElementById('singleDay').value = today;
            document.getElementById('periodFrom').value = firstDayStr;
            document.getElementById('periodTo').value = today;
        };
    </script>
</body>
</html>
