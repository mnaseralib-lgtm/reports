<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</title>
  <style>
    body { font-family: Tahoma, sans-serif; background-color: #f4f6f9; margin: 0; padding: 0; }
    header { background-color: #007bff; color: white; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; }
    .container { width: 90%; margin: 20px auto; }
    .card { background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; align-items: center; }
    label { font-weight: bold; }
    input, button { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #007bff; color: white; cursor: pointer; }
    button:hover { background: #0056b3; }
    .export-btn { background-color: #28a745 !important; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #007bff; color: white; }
    .message { color: #d9534f; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>

<header>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</header>

<div class="container">

  <!-- âœ… ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù -->
  <div class="card">
    <h3>ğŸ“Œ ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù Ù„ÙØªØ±Ø© Ø²Ù…Ù†ÙŠØ©</h3>
    <div class="row">
      <label>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù:</label>
      <input type="text" id="employeeCodeInput" placeholder="Ù…Ø«Ø§Ù„: 102">
      <label>Ù…Ù†:</label><input type="date" id="fromDate">
      <label>Ø¥Ù„Ù‰:</label><input type="date" id="toDate">
      <button id="btnSingle">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>
    <div id="singleReportArea"></div>
  </div>

  <!-- âœ… ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
  <div class="card">
    <h3>ğŸ“Œ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ Ù„ÙƒØ§ÙØ© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
    <div class="row">
      <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label><input type="date" id="dayDate">
      <button id="btnDay">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>
    <div id="dayReportArea"></div>
  </div>

</div>

<script>
  // âš ï¸ Ø¶Ø¹ Ø±Ø§Ø¨Ø· Web App Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ù€ /exec)
  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwz-V9jtbufbUDfm6Pcf8dDpUP7LxjhshcDrYBNO2b78PdoClVgzL17izSmtzz8loH1aQ/exec";

  async function api(action, params={}) {
    const url = new URL(GOOGLE_SCRIPT_URL);
    url.searchParams.set("action", action);
    Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));
    const response = await fetch(url);
    return response.json();
  }

  function renderTable(containerId, rows) {
    if (!rows || rows.length === 0) {
      document.getElementById(containerId).innerHTML = `<p class="message">âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</p>`;
      return;
    }
    let table = `<table>
      <thead>
        <tr>
          <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ù‡Ù†Ø©</th><th>Ø§Ù„ÙØ¦Ø©</th>
          <th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th><th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
          <th>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th><th>Ø§Ù„Ø§Ø¶Ø§ÙÙŠ</th>
        </tr>
      </thead>
      <tbody>`;
    rows.forEach(r => {
      table += `<tr>
        <td>${r.employee_id}</td>
        <td>${r.name || "-"}</td>
        <td>${r.occupation || "-"}</td>
        <td>${r.manday_rate || "-"}</td>
        <td>${r.first_in || "-"}</td>
        <td>${r.last_out || "-"}</td>
        <td>${r.work_hours_str || "00:00"}</td>
        <td>${r.overtime_hours_str || "00:00"}</td>
      </tr>`;
    });
    table += "</tbody></table>";
    document.getElementById(containerId).innerHTML = table;
  }

  // ğŸ“Œ ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù
  document.getElementById("btnSingle").onclick = async () => {
    const emp = document.getElementById("employeeCodeInput").value.trim();
    const from = document.getElementById("fromDate").value;
    const to = document.getElementById("toDate").value;
    if (!emp || !from || !to) return alert("âš  ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©");
    const data = await api("singleReport", { employee_id: emp, from, to });
    renderTable("singleReportArea", data.days || []);
  };

  // ğŸ“Œ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ
  document.getElementById("btnDay").onclick = async () => {
    const day = document.getElementById("dayDate").value;
    if (!day) return alert("âš  ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹");
    const data = await api("dayReport", { day });
    renderTable("dayReportArea", data);
  };
</script>
</body>
</html>
