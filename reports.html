<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</title>
    <style>
        body {font-family: "Cairo", sans-serif; margin: 20px; direction: rtl; text-align: right;}
        select, input, button {
            padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px;
            font-size: 14px;
        }
        table {width: 100%; border-collapse: collapse; margin-top: 15px;}
        th, td {border: 1px solid #ddd; padding: 8px; text-align: center;}
        th {background-color: #f2f2f2;}
        .hidden {display: none;}
        .message {color: red; margin-top: 10px; font-weight: bold;}
    </style>
</head>
<body>

    <h2>ğŸ“Š Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
    <label for="reportType">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</label>
    <select id="reportType" onchange="toggleReportForm()">
        <option value="employee">ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù</option>
        <option value="day">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ†</option>
        <option value="period">ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù…Ø¹ Ù„ÙØªØ±Ø©</option>
    </select>

    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù -->
    <div id="employeeReportForm">
        <label>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙˆØ¸Ù:</label>
        <input type="text" id="employeeId" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯">
        <label>Ù…Ù†:</label>
        <input type="date" id="fromDate">
        <label>Ø¥Ù„Ù‰:</label>
        <input type="date" id="toDate">
        <button onclick="fetchEmployeeReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ† -->
    <div id="dayReportForm" class="hidden">
        <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" id="singleDay">
        <button onclick="fetchDayReport()">Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø±ÙŠØ± ÙØªØ±Ø© (Ù…Ø¬Ù…Ø¹) -->
    <div id="periodReportForm" class="hidden">
        <label>Ù…Ù†:</label>
        <input type="date" id="periodFrom">
        <label>Ø¥Ù„Ù‰:</label>
        <input type="date" id="periodTo">
        <button onclick="fetchPeriodReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¬Ù…Ø¹</button>
    </div>

    <div id="message" class="message"></div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <table id="resultsTable" class="hidden">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
    </table>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzMguB1k61uZ2Jz7zHB4MuiuDFKD7k6tzt4gjGk-a4egN8zUOIwDVH9kEqaMHqUyGUsbA/exec"; // Ø¶Ø¹ Ø±Ø§Ø¨Ø· Google Apps Script Ù‡Ù†Ø§

        function toggleReportForm() {
            const type = document.getElementById("reportType").value;
            document.getElementById("employeeReportForm").classList.toggle("hidden", type !== "employee");
            document.getElementById("dayReportForm").classList.toggle("hidden", type !== "day");
            document.getElementById("periodReportForm").classList.toggle("hidden", type !== "period");
            document.getElementById("message").innerHTML = "";
            document.getElementById("resultsTable").classList.add("hidden");
        }

        // âœ… Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¸Ù
        async function fetchEmployeeReport() {
            const emp = document.getElementById("employeeId").value.trim();
            const from = document.getElementById("fromDate").value;
            const to = document.getElementById("toDate").value;

            if (!emp || !from || !to) {
                document.getElementById("message").innerHTML = "âš  ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.";
                return;
            }

            const url = `${SCRIPT_URL}?action=singleReport&employee_id=${emp}&from=${from}&to=${to}`;
            const res = await fetch(url);
            const data = await res.json();

            if (!data.days || data.days.length === 0) {
                document.getElementById("message").innerHTML = "âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.";
                document.getElementById("resultsTable").classList.add("hidden");
                return;
            }

            document.getElementById("message").innerHTML = "";
            renderTable(
                ["Ø§Ù„ØªØ§Ø±ÙŠØ®", "Ø§Ù„ÙƒÙˆØ¯", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù…Ù‡Ù†Ø©", "Ø§Ù„Ø¯Ø®ÙˆÙ„", "Ø§Ù„Ø®Ø±ÙˆØ¬", "Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„", "Ø§Ù„Ø£ÙˆÙØ± ØªØ§ÙŠÙ…"],
                data.days.map(d => [
                    d.date, d.employee_id, d.name, d.occupation,
                    d.first_in, d.last_out, d.work_hours_str, d.overtime_hours_str
                ])
            );
        }

        // âœ… Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ
        async function fetchDayReport() {
            const day = document.getElementById("singleDay").value;
            if (!day) {
                document.getElementById("message").innerHTML = "âš  ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ®.";
                return;
            }
            const url = `${SCRIPT_URL}?action=dayReport&day=${day}`;
            const data = await (await fetch(url)).json();

            if (data.length === 0) {
                document.getElementById("message").innerHTML = "âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….";
                return;
            }

            document.getElementById("message").innerHTML = "";
            renderTable(
                ["Ø§Ù„ÙƒÙˆØ¯", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù…Ù‡Ù†Ø©", "Ø§Ù„Ø¯Ø®ÙˆÙ„", "Ø§Ù„Ø®Ø±ÙˆØ¬", "Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„", "Ø§Ù„Ø£ÙˆÙØ± ØªØ§ÙŠÙ…"],
                data.map(d => [
                    d.employee_id, d.name, d.occupation,
                    d.first_in, d.last_out, d.work_hours_str, d.overtime_hours_str
                ])
            );
        }

        // âœ… Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± Ù…Ø¬Ù…Ø¹
        async function fetchPeriodReport() {
            const from = document.getElementById("periodFrom").value;
            const to = document.getElementById("periodTo").value;
            if (!from || !to) {
                document.getElementById("message").innerHTML = "âš  ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØªØ±Ø©.";
                return;
            }
            const url = `${SCRIPT_URL}?action=periodReport&from=${from}&to=${to}`;
            const data = await (await fetch(url)).json();

            if (Object.keys(data).length === 0) {
                document.getElementById("message").innerHTML = "âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‰ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.";
                return;
            }

            document.getElementById("message").innerHTML = "";
            renderTable(
                ["Ø§Ù„ÙƒÙˆØ¯", "Ø§Ù„Ø§Ø³Ù…", "Ø§Ù„Ù…Ù‡Ù†Ø©", "Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…", "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„", "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙˆÙØ±"],
                Object.values(data).map(d => [
                    d.employee_id, d.name, d.occupation,
                    d.days_present, d.total_work_hours_str, d.total_overtime_hours_str
                ])
            );
        }

        // âœ… Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function renderTable(headers, rows) {
            const thead = document.getElementById("tableHead");
            const tbody = document.getElementById("tableBody");
            const table = document.getElementById("resultsTable");

            thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`;
            tbody.innerHTML = rows.map(r => `<tr>${r.map(c => `<td>${c}</td>`).join("")}</tr>`).join("");

            table.classList.remove("hidden");
        }
    </script>

</body>
</html>
